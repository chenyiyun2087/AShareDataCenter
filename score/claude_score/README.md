# 股票多维度评分查询

基于 DWS 评分表的股票评分查询模块。

## 说明

评分**计算逻辑**已移至 ETL 流水线：
- 路径: `scripts/etl/dws/scoring.py`
- 运行: `python scripts/run_dws.py --mode incremental`

本模块仅提供**查询功能**，从预计算的 DWS 表读取评分数据。

## 评分规则详解 (总分 100)

### 1. 动量评分 (25分)
反映股价上涨的动力和活跃度。

| 指标 | 权重 | 评分规则 (满足条件即得分) |
|------|------|--------------------------------|
| **5日涨幅** | 5分 | >10%: 5分 \| >5%: 4分 \| >2%: 3分 \| >0%: 2分 |
| **20日涨幅** | 5分 | >20%: 5分 \| >10%: 4分 \| >5%: 3分 \| >0%: 2分 |
| **60日涨幅** | 5分 | >30%: 5分 \| >15%: 4分 \| >5%: 3分 \| >0%: 2分 |
| **量比** | 5分 | >1.5: 5分 \| >1.2: 4分 \| >1.0: 3分 \| 其他: 1分 |
| **换手率** | 5分 | >10%: 5分 \| >5%: 4分 \| >2%: 3分 \| 其他: 1分 |

### 2. 价值评分 (20分)
基于相对估值，低估值策略。

| 指标 | 权重 | 评分规则 |
|------|------|----------|
| **PE (TTM)** | 7分 | <15: 7分 \| <25: 5分 \| <40: 3分 \| <60: 1分 |
| **PB** | 7分 | <1.0: 7分 (破净) \| <2.0: 6分 \| <3.0: 4分 \| <5.0: 2分 |
| **PS (TTM)** | 6分 | <1.0: 6分 \| <2.0: 5分 \| <3.0: 3分 \| <5.0: 1分 |

### 3. 质量评分 (20分)
基于基本面财务指标。

| 指标 | 权重 | 评分规则 |
|------|------|----------|
| **ROE (TTM)** | 8分 | >20%: 8分 \| >15%: 6分 \| >10%: 4分 \| >5%: 2分 |
| **毛利率** | 6分 | >50%: 6分 \| >30%: 5分 \| >20%: 3分 \| >10%: 1分 |
| **资产负债率** | 6分 | <30%: 6分 \| <50%: 5分 \| <70%: 3分 \| 其他: 1分 |

### 4. 技术评分 (15分)
基于经典技术指标 (使用前复权数据)。

| 指标 | 权重 | 评分规则 |
|------|------|----------|
| **MACD** | 5分 | 金叉(DIF>DEA & MACD>0): 5分 \| 红柱(MACD>0): 3分 \| 多头(DIF>DEA): 2分 |
| **KDJ (J值)** | 5分 | 超卖(<20): 5分 \| 强势区(40-60): 3分 \| 超买(>80): 0分 |
| **RSI (6日)** | 5分 | 超卖(<30): 5分 \| 强势区(40-60): 3分 \| 超买(>70): 0分 |

### 5. 资金评分 (10分)
基于主力资金流向。

| 指标 | 权重 | 评分规则 (净流入金额) |
|------|------|----------------------|
| **特大单** | 6分 | >1亿: 6分 \| >5千万: 5分 \| >1千万: 3分 \| >0: 1分 |
| **大单** | 4分 | >5千万: 4分 \| >2千万: 3分 \| >0: 1分 |

### 6. 筹码评分 (10分)
基于筹码分布和获利盘。

| 指标 | 权重 | 评分规则 |
|------|------|----------|
| **获利比例** | 6分 | 极度套牢(<10%): 6分 (反转预期) \| <30%: 5分 \| 震荡(40-60%): 3分 \| 高获利(>90%): 1分 (风险) |
| **成本偏离** | 4分 | 突破成本(现价/成本>1.1): 4分 \| >1.05: 3分 \| 站稳成本(>1.0): 2分 |

## 数据表说明

| 维度 | 数据表 | 字段 |
|------|--------|------|
| 动量 | `dws_momentum_score` | `momentum_score` |
| 价值 | `dws_value_score` | `value_score` |
| 质量 | `dws_quality_score` | `quality_score` |
| 技术 | `dws_technical_score` | `technical_score` |
| 资金 | `dws_capital_score` | `capital_score` |
| 筹码 | `dws_chip_score` | `chip_score` |

## 快速使用

```python
from score_query import ScoreQuery, get_engine

engine = get_engine(password='your_password')
q = ScoreQuery(engine)

# 获取Top股票
top = q.get_top_stocks(trade_date=20260206, top_n=50)

# 自定义筛选
filtered = q.screen_stocks(20260206, {
    'total_score': (60, 100),
    'momentum_score': (15, None)
})

# 单股趋势
trend = q.get_stock_scores('000001.SZ', 20260101, 20260206)
```

## 文件说明

| 文件 | 用途 |
|------|------|
| `score_query.py` | 评分查询类 |
| `advanced_analysis.py` | 高级分析(回测/行业对比) |
